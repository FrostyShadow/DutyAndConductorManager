@model List<ISSK_2_0.Models.Brigade>
@{
    ViewBag.Title = "Kalendarz";
    var currentMonth = DateTime.Now.Month;
    var nextMonth = DateTime.Now.AddMonths(1).Month;
    var currentMonthYear = DateTime.Now.Year;
    var nextMonthYear = DateTime.Now.AddMonths(1).Year;
    
    var firstDayOfCurrentMonth = new DateTime(currentMonthYear, currentMonth, 1);
    var firstDayOfNextMonth = new DateTime(nextMonthYear, nextMonth, 1);
    var daysInCurrentMonth = DateTime.DaysInMonth(currentMonthYear, currentMonth);
    var lastDayOfCurrentMonth = new DateTime(currentMonthYear, currentMonth, daysInCurrentMonth);
    var daysInNextMonth = DateTime.DaysInMonth(nextMonthYear, nextMonth);
    var lastDayOfNextMonth = new DateTime(nextMonthYear,nextMonth, daysInNextMonth);

    var dayOfWeekFirstInCurrentMonth = (int) firstDayOfCurrentMonth.DayOfWeek > 0 ? (int) firstDayOfCurrentMonth.DayOfWeek : 7;
    var dayOfWeekFirstInNextMonth = (int) firstDayOfNextMonth.DayOfWeek > 0 ? (int) firstDayOfNextMonth.DayOfWeek : 7;
    var dayOfWeekLastInCurrentMonth = (int) lastDayOfCurrentMonth.DayOfWeek > 0 ? (int) lastDayOfCurrentMonth.DayOfWeek : 7;
    var dayOfWeekLastInNextMonth = (int) lastDayOfNextMonth.DayOfWeek > 0 ? (int) lastDayOfNextMonth.DayOfWeek : 7;
}

<div class="jumbotron">
    <h4>@ViewBag.Title</h4>
    @if (Model == null || !Model.Any(d => d.ServiceDateTime >= DateTime.Now))
    {
        <p class="text-danger">
            Obecnie nie ma żadnych otwartych zapisów na służby
        </p>
    }
    <hr />

    <div class="row">
        <div class="col-md-5">
            <h4 class="text-center">
                @DateTime.Now.ToString("MMMM yyyy")
            </h4>
            <table class="table table-bordered">

                <thead class="thead-dark text-center">
                <tr>
                    <th>
                        pon
                    </th>
                    <th>
                        wt
                    </th>
                    <th>
                        śr
                    </th>
                    <th>
                        czw
                    </th>
                    <th>
                        pt
                    </th>
                    <th>
                        sob
                    </th>
                    <th>
                        nd
                    </th>
                </tr>
                </thead>
                <tbody class="text-center">
                <tr>
                @for (var a = 1; a < dayOfWeekFirstInCurrentMonth; a++)
                {
                    @:<td></td>
                }
                
                @for (var i = 1; i <= daysInCurrentMonth; i++)
                {
                    DateTime renderedDay = new DateTime(currentMonthYear, currentMonth, i);

                    if (renderedDay.DayOfWeek == DayOfWeek.Sunday)
                    {
                        @:<td>@i</td></tr><tr>
                    }
                    else
                    {
                        @:<td>@i</td>
                    }            
                }
                
                @for (var a = 1; a <= 7-dayOfWeekLastInCurrentMonth; a++)
                {
                    @:<td></td>
                }
                </tr>
                </tbody>
            </table>
        </div>
        <div class="col-md-5 offset-1">
            <h4 class="text-center">@DateTime.Now.AddMonths(1).ToString("MMMM yyyy")</h4>
            <table class="table table-bordered">
                <thead class="thead-dark text-center">
                <tr>
                    <th>
                        pon
                    </th>
                    <th>
                        wt
                    </th>
                    <th>
                        śr
                    </th>
                    <th>
                        czw
                    </th>
                    <th>
                        pt
                    </th>
                    <th>
                        sob
                    </th>
                    <th>
                        nd
                    </th>
                </tr>
                </thead>
                <tbody class="text-center">
                <tr>
                    @for (var a = 1; a < dayOfWeekFirstInNextMonth; a++)
                    {
                        @:<td></td>
                    }
                
                    @for (var i = 1; i <= daysInNextMonth; i++)
                    {
                        DateTime renderedDay = new DateTime(nextMonthYear, nextMonth, i);

                        if (renderedDay.DayOfWeek == DayOfWeek.Sunday)
                        {
                            @:<td>@i</td></tr><tr>
                        }
                        else
                        {
                            @:<td>@i</td>
                        }            
                    }
                    
                    @for (var a = 1; a <= 7-dayOfWeekLastInNextMonth; a++)
                    {
                        @:<td></td>
                    }
                </tr>
                </tbody>
            </table>
        </div>
    </div>
</div>